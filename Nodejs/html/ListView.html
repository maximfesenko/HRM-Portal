<html>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>

	<!-- Latest compiled and minified CSS -->
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">

	<!-- Optional theme -->
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap-theme.min.css">

	<link rel="stylesheet" href="/css/start.css">

	<!-- Latest compiled and minified JavaScript -->
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

	<style>
		#listViewTableId {
			border: 1px solid black;
			margin: 0% 35%;
		}

		#listViewTableId tr td {
			text-align: center;
		}

		body {
			padding-top: 0px !important;
		}
	</style>

	<body>
		<ul class="nav nav-tabs tabs-up" id="friends">
			<li>
				<a href="#" data-target="#listViewId" class="media_node active span" id="listViewId_tab" data-toggle="tabajax" rel="tooltip"> List View </a>
			</li>
			<li>
				<a href="#" data-target="#createTableId" class="media_node span" id="createTableId_tab" data-toggle="tabajax" rel="tooltip"> Create Table </a>
			</li>
			<li>
				<a href="#" data-target="#clearTableId" class="media_node span" id="clearTableId_tab" data-toggle="tabajax" rel="tooltip"> Clear Table </a>
			</li>
		</ul>

		<div class="tab-content">
			<div class="tab-pane active" id="listViewId">
				<button class="btn btn-default" onclick="func(); return false;">Show table</button>

				<table id="listViewTableId" border="1"></table>
			</div>

			<div class="tab-pane" id="createTableId">

			</div>

			<div class="tab-pane  urlbox span8" id="clearTableId">

			</div>
		</div>
	</body>

	<script>
		$('[data-toggle="tabajax"]').click(function(e) {
			var $this = $(this),
			loadurl = $this.attr('href'),
			targ = $this.attr('data-target');

			$.get(loadurl, function(data) {
				$(targ).html(data);
			});

			$this.tab('show');
			return false;
		});

		function func() {
			var parts = location.search.substring(1).split('&');
			var parameters = {};

			for (var i = 0; i < parts.length; i++) {
				var param = parts[i].split('=');
				parameters[param[0]] = param[1];
			}
			console.log("parameters=",parameters);

			$.get("/ajaxListView?name=" + parameters.name, function( data ) {
				console.log(data);
				var headers = [];
				for (var i = 0; i < data.fields.length; i++) {
					headers.push('<th>' + data.fields[i] + '</th>');
				}

				var rows = [];
				for (var i = 0; i < data.items.length; i++) {
					rows.push('<tr>');
					$.each(data.fields, function(index, value) {
						rows.push('<td>' + data.items[i][value] + '</td>');
					});
					rows.push('</tr>');
				}

				$("#listViewTableId").html($([
						'<tr>',
							headers,
						'</tr>',
						rows
					].join(""))
				);
			})
			.fail(function(data) {
				console.log(JSON.parse(data.responseText).message);
			});
		}
	</script>
</html>