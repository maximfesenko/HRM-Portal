<html>
	<script src="https://code.jquery.com/jquery-1.11.3.min.js"></script>

	<!-- Latest compiled and minified CSS -->
	<link rel="stylesheet" href="/css/bootstrap.min.css">
	<link rel="stylesheet" href="https://cdn.datatables.net/1.10.9/css/dataTables.bootstrap.min.css">
	<script src="https://cdn.datatables.net/1.10.9/js/jquery.dataTables.min.js"></script>
	<script src="https://cdn.datatables.net/1.10.9/js/dataTables.bootstrap.min.js"></script>

	<!-- Optional theme -->
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap-theme.min.css">

	<link rel="stylesheet" href="/css/start.css">
	<link rel="stylesheet" href="/css/bootstrap-select.min.css">
	<script src="/js/bootstrap-select.js"></script>

	<!-- Latest compiled and minified JavaScript -->
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />



	<style>
		#listViewTableId tr td {
			text-align: center;
		}

		body {
			padding-top: 0px !important;
		}
	</style>

	<body>
		<ul class="nav nav-tabs tabs-up" id="friends">
			<li>
				<a href="#" data-target="#listViewId" class="media_node active span" id="listViewId_tab" data-toggle="tabajax" rel="tooltip"> List View </a>
			</li>
			<li>
				<a href="#" data-target="#createTableId" class="media_node span" id="createTableId_tab" data-toggle="tabajax" rel="tooltip"> Create Table </a>
			</li>
			<li>
				<a href="#" data-target="#clearTableId" class="media_node span" id="clearTableId_tab" data-toggle="tabajax" rel="tooltip"> Clear Table </a>
			</li>
		</ul>

		<div class="tab-content">
			<div class="tab-pane active" id="listViewId">
				<div class="dropdown" align="center">
					<button class="btn btn-primary dropdown-toggle" type="button" data-toggle="dropdown" id="dropdownButtonId" style="display: block;">
						Tables
						<span class="caret"></span>
					</button>

					<ul class="dropdown-menu" id="dropdownUlId">

					</ul>
				</div>

				<table class="table table-striped table-bordered" cellspacing="0" width="100%" id="listViewTableId" border="1"></table>
			</div>

			<div class="tab-pane" id="createTableId">

			</div>

			<div class="tab-pane" id="clearTableId">

			</div>
		</div>
	</body>

	<script>
		$('[data-toggle="tabajax"]').click(function(e) {
			var $this = $(this),
			loadurl = $this.attr('href'),
			targ = $this.attr('data-target');

			$.get(loadurl, function(data) {
				$(targ).html(data);
			});

			$this.tab('show');
			return false;
		});

		function selectTable(select) {
			$('#dropdownButtonId').html($(select).text() + '&nbsp;<span class="caret"></span>');

			$.get("/ajaxListView?name=" + $(select).text(), function( data ) {
				console.log(data);
				var headers = [];
				for (var i = 0; i < data.fields.length; i++) {
					headers.push('<th>' + data.fields[i] + '</th>');
				}

				var rows = [];
				for (var i = 0; i < data.items.length; i++) {
					rows.push('<tr>');
					$.each(data.fields, function(index, value) {
						rows.push(
							'<td>' +
							((data.items[i][value] !== undefined && data.items[i][value] !== 'undefined')
								? data.items[i][value]
								: ''
							) +
							'</td>');
					});
					rows.push('</tr>');
				}

				if (rows.length === 0) {
					rows.push('<tr><td colspan="' + headers.length + '">' + $(select).text() + ' is empty.</td></tr>');
				}
				$("#listViewTableId").html($([
					'<thead>',
					'<tr>',
						headers,
					'</tr>',
					'</thead>',
					'<tbody>',
						rows,
					'</tbody>'
				].join("")));

				$('#listViewTableId').DataTable();
			})
			.fail(function(data) {
				console.log(JSON.parse(data.responseText).message);
			});
		}

		$(document).ready(function() {
			var parts = location.search.substring(1).split('&');
			var parameters = {};

			for (var i = 0; i < parts.length; i++) {
				var param = parts[i].split('=');
				parameters[param[0]] = param[1];
			}
			console.log("parameters=",parameters);

			$.get("/ajaxListTables", function( data ) {
				var tables = [];
				for (var i = 0; i < data.length; i++) {
					if (data[i].indexOf('sqlite') === -1) {
						tables.push('<li><a href="#" onclick="selectTable(this); return false;">' + data[i] + '</a></li>');
					}
				}

				$("#dropdownUlId").append(tables.join(""));

				selectTable($("#dropdownUlId").find("li:first-child"));
			});
		});
	</script>
</html>